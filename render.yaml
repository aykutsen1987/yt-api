# ============================================
# RENDER Deployment Configuration
# YouTube to MP3/M4A Converter API
# ============================================

services:
  - type: web
    name: yt-api
    env: python
    region: oregon  # veya size en yakÄ±n region: frankfurt, singapore, ohio
    plan: free  # free, starter, standard, pro
    
    # âœ… Build Command - FFmpeg kurulumu dahil
    buildCommand: |
      echo "ðŸ”§ Installing system dependencies..."
      apt-get update && apt-get install -y ffmpeg
      echo "âœ… FFmpeg installed"
      ffmpeg -version
      echo "ðŸ“¦ Installing Python dependencies..."
      pip install --upgrade pip
      pip install -r requirements.txt
      echo "âœ… Build complete"
    
    # âœ… Start Command - Uvicorn server
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT --workers 2
    
    # âœ… Environment Variables
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      
      - key: PORT
        value: 10000
      
      - key: LOG_LEVEL
        value: info
      
      - key: WORKERS
        value: 2
      
      # âœ… FFmpeg path (RENDER'da default)
      - key: FFMPEG_PATH
        value: /usr/bin/ffmpeg
      
      # âœ… Temp directory
      - key: TEMP_DIR
        value: /tmp
    
    # âœ… Health Check
    healthCheckPath: /health
    
    # âœ… Auto Deploy (GitHub push'ta otomatik deploy)
    autoDeploy: true
    
    # âœ… Branch
    branch: main  # veya master
    
    # âœ… Root Directory (eÄŸer subdirectory'deyse)
    # rootDir: backend
    
    # âœ… Disk (persistent storage - opsiyonel)
    # disk:
    #   name: yt-api-disk
    #   mountPath: /data
    #   sizeGB: 1

# ============================================
# RENDER PLAN RECOMMENDATIONS
# ============================================
# 
# FREE PLAN:
# - 512 MB RAM
# - 0.1 CPU
# - Cold start (30-60s inactivity sonrasÄ±)
# - AylÄ±k 750 saat
# - Yeterli: Test ve dÃ¼ÅŸÃ¼k trafik
#
# STARTER PLAN ($7/month):
# - 512 MB RAM
# - 0.5 CPU
# - Always on (cold start yok)
# - Ã–nerilen: Production kullanÄ±m
#
# STANDARD PLAN ($25/month):
# - 2 GB RAM
# - 1 CPU
# - Always on
# - Ã–nerilen: YÃ¼ksek trafik
#
# ============================================

# ============================================
# ALTERNATIVE: Aptfile (FFmpeg iÃ§in)
# ============================================
# EÄŸer buildCommand'da apt-get Ã§alÄ±ÅŸmazsa,
# proje root'una "Aptfile" dosyasÄ± ekleyin:
#
# Aptfile iÃ§eriÄŸi:
# ffmpeg
#
# ============================================
